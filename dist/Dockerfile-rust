FROM base-rust

WORKDIR /build
RUN git clone --recursive https://github.com/rust-lang/rust
WORKDIR /build/rust
RUN ./configure --prefix=/rust
RUN make -j10
RUN make install

ENV PATH=/rust/bin:$PATH
ENV LD_LIBRARY_PATH=/rust/lib

WORKDIR /build
RUN git clone --recursive https://github.com/rust-lang/cargo
WORKDIR /build/cargo
RUN ./configure --prefix=/rust --enable-optimize
RUN make
RUN make install

RUN rm -rf /build
WORKDIR /home/rustbuild
